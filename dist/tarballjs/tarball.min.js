/*
Minified version of: https://github.com/ankitrohatgi/tarballjs
I am simply hosting the minified file here, full ownership and rights remain with the original author.
This file is licenced under MIT, Copyright (c) 2017 Ankit Rohatgi
*/
let tarball={};"object"==typeof module&&"object"==typeof module.exports?module.exports=tarball:"object"==typeof this&&(this.tarball=tarball),tarball.TarReader=class{constructor(){this.fileInfo=[]}readFile(e){return new Promise((t,i)=>{let r=new FileReader;r.onload=e=>{this.buffer=e.target.result,this.fileInfo=[],this._readFileInfo(),t(this.fileInfo)},r.readAsArrayBuffer(e)})}readArrayBuffer(e){return this.buffer=e,this.fileInfo=[],this._readFileInfo(),this.fileInfo}_readFileInfo(){this.fileInfo=[];let e=0,t=0,i="",r=null;for(;e<this.buffer.byteLength-512&&0!=(i=this._readFileName(e)).length;)r=this._readFileType(e),t=this._readFileSize(e),this.fileInfo.push({name:i,type:r,size:t,header_offset:e}),e+=512+512*Math.trunc(t/512),t%512&&(e+=512)}getFileInfo(){return this.fileInfo}_readString(e,t){let i=new Uint8Array(this.buffer,e,t),r=i.indexOf(0);return new TextDecoder().decode(i.slice(0,r))}_readFileName(e){return this._readString(e,100)}_readFileType(e){let t=String.fromCharCode(new Uint8Array(this.buffer,e+156,1)[0]);return"0"==t?"file":"5"==t?"directory":t}_readFileSize(e){let t=new Uint8Array(this.buffer,e+124,12),i="";for(let r=0;r<11;r++)i+=String.fromCharCode(t[r]);return parseInt(i,8)}_readFileBlob(e,t,i){let r=new Uint8Array(this.buffer,e,t);return new Blob([r],{type:i})}_readFileBinary(e,t){return new Uint8Array(this.buffer,e,t)}_readTextFile(e,t){let i=new Uint8Array(this.buffer,e,t);return new TextDecoder().decode(i)}getTextFile(e){let t=this.fileInfo.find(t=>t.name==e);if(t)return this._readTextFile(t.header_offset+512,t.size)}getFileBlob(e,t){let i=this.fileInfo.find(t=>t.name==e);if(i)return this._readFileBlob(i.header_offset+512,i.size,t)}getFileBinary(e){let t=this.fileInfo.find(t=>t.name==e);if(t)return this._readFileBinary(t.header_offset+512,t.size)}},tarball.TarWriter=class{constructor(){this.fileData=[]}addTextFile(e,t,i){let r=new TextEncoder().encode(t);this.fileData.push({name:e,array:r,type:"file",size:r.length,dataType:"array",opts:i})}addFileArrayBuffer(e,t,i){let r=new Uint8Array(t);this.fileData.push({name:e,array:r,type:"file",size:r.length,dataType:"array",opts:i})}addFile(e,t,i){this.fileData.push({name:e,file:t,size:t.size,type:"file",dataType:"file",opts:i})}addFolder(e,t){this.fileData.push({name:e,type:"directory",size:0,dataType:"none",opts:t})}_createBuffer(){let e=0;for(let t=0;t<this.fileData.length;t++){let i=this.fileData[t].size;e+=512+512*Math.trunc(i/512),i%512&&(e+=512)}let r=10240*Math.trunc(e/10240);e%10240&&(r+=10240),this.buffer=new ArrayBuffer(r)}async download(e){let t=await this.writeBlob(),i=document.createElement("a");i.href=URL.createObjectURL(t),i.download=e,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}async writeBlob(e){return new Blob([await this.write(e)],{type:"application/x-tar"})}write(e){return new Promise((t,i)=>{this._createBuffer();let r=0,l=0,a=()=>{if(l++,e&&e(l/this.fileData.length*100),l===this.fileData.length){let i=new Uint8Array(this.buffer);t(i)}};for(let s=0;s<this.fileData.length;s++){let n=this.fileData[s];this._writeFileName(n.name,r),this._writeFileType(n.type,r),this._writeFileSize(n.size,r),this._fillHeader(r,n.opts,n.type),this._writeChecksum(r);let f=new Uint8Array(this.buffer,r+512,n.size);if("array"===n.dataType){for(let h=0;h<n.size;h++)f[h]=n.array[h];a()}else if("file"===n.dataType){let o=new FileReader;o.onload=function(e){let t=e;return function(e){let i=e.target.result,r=new Uint8Array(i);for(let l=0;l<r.length;l++)t[l]=r[l];a()}}(f),o.readAsArrayBuffer(n.file)}else"directory"===n.type&&a();r+=512+512*Math.trunc(n.size/512),n.size%512&&(r+=512)}})}_writeString(e,t,i){let r=new Uint8Array(this.buffer,t,i),l=new TextEncoder;if(l.encodeInto){let a=l.encodeInto(e,r).written;for(let s=a;s<i;s++)r[s]=0}else{let n=l.encode(e);for(let f=0;f<i;f++)r[f]=f<n.length?n[f]:0}}_writeFileName(e,t){this._writeString(e,t,100)}_writeFileType(e,t){let i="0";"file"===e?i="0":"directory"===e&&(i="5");new Uint8Array(this.buffer,t+156,1)[0]=i.charCodeAt(0)}_writeFileSize(e,t){let i=e.toString(8);i=this._leftPad(i,11),this._writeString(i,t+124,12)}_leftPad(e,t){let i=e+"";for(;i.length<t;)i="0"+i;return i}_writeFileMode(e,t){this._writeString(this._leftPad(e,7),t+100,8)}_writeFileUid(e,t){this._writeString(this._leftPad(e,7),t+108,8)}_writeFileGid(e,t){this._writeString(this._leftPad(e,7),t+116,8)}_writeFileMtime(e,t){this._writeString(this._leftPad(e,11),t+136,12)}_writeFileUser(e,t){this._writeString(e,t+265,32)}_writeFileGroup(e,t){this._writeString(e,t+297,32)}_writeChecksum(e){this._writeString("        ",e+148,8);let t=new Uint8Array(this.buffer,e,512),i=0;for(let r=0;r<512;r++)i+=t[r];this._writeString(i.toString(8),e+148,8)}_getOpt(e,t,i){return null!=e&&null!=e[t]?e[t]:i}_fillHeader(e,t,i){let r=this._getOpt(t,"uid",1e3),l=this._getOpt(t,"gid",1e3),a=this._getOpt(t,"mode","file"===i?"664":"775"),s=this._getOpt(t,"mtime",Date.now()),n=this._getOpt(t,"user","tarballjs"),f=this._getOpt(t,"group","tarballjs");this._writeFileMode(a,e),this._writeFileUid(r.toString(8),e),this._writeFileGid(l.toString(8),e),this._writeFileMtime(Math.trunc(s/1e3).toString(8),e),this._writeString("ustar",e+257,6),this._writeString("00",e+263,2),this._writeFileUser(n,e),this._writeFileGroup(f,e)}};